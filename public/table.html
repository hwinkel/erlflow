<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <meta name="generator" content="HTML Tidy, see www.w3.org">
        <meta http-equiv="content-type" content= "text/html; charset=utf-8">
        <title>Dynamically Loading Node Data</title>
        <style type="text/css">
            body {
                margin: 0;
                padding: 0;
            }
        </style>
        <link rel="stylesheet" type="text/css" href= "/build/fonts/fonts-min.css">
        <link rel="stylesheet" type="text/css" href= "/build/treeview/assets/skins/sam/treeview.css">
        <script type="text/javascript" src= "/build/yahoo/yahoo-min.js">
        </script>
        <script type="text/javascript" src= "/build/event/event-min.js">
        </script>
        <script type="text/javascript" src= "/build/connection/connection-min.js">
        </script>
        <script type="text/javascript" src= "/build/treeview/treeview-min.js">
        </script>
        <script src="/build/json/json-min.js">
        </script>
        <style type="text/css">
            #treeDiv1 {
                background: #fff;
                margin-top: 1em;
                padding: 1em;
                min-height: 7em;
            }
        </style>
    </head>
    <body class=" yui-skin-sam">
        <h1>Dynamically Loading Node Data</h1>

        <div id="treeDiv1">
        </div>
		
        <script type="text/javascript">
        	Erlflow = new Object();
			Erlflow.main = new Object();
            
            Erlflow.main.treeProcesses = function(){
            
                var tree, currentIconMode;
                
                function changeIconMode(){
                    var newVal = parseInt(this.value);
                    if (newVal != currentIconMode) {
                        currentIconMode = newVal;
                    }
                    buildTree();
                }
                
                function loadNodeData(node, fnLoadComplete){
                    var nodeLabel = encodeURI(node.label);
                    var sUrl = "erlflow/" + nodeLabel;
                    var callback = {
                        success: function(oResponse){
                            YAHOO.log("XHR transaction was successful.", "info", "example");
                            YAHOO.log(oResponse.responseText);
                            var oResults = YAHOO.lang.JSON.parse(oResponse.responseText);                            
                            
                            for (var i = 0, j = oResults.networks.length; i < j; i++) {
                                var tempNode = new YAHOO.widget.TextNode(oResults.networks[i].name, node, false);
								tempNode.isLeaf = true;
                            }
                            
                            oResponse.argument.fnLoadComplete();
                        },
                        
                        failure: function(oResponse){
                            YAHOO.log("Failed to process XHR transaction.", "info", "example");
                            oResponse.argument.fnLoadComplete();
                        },
                        argument: {
                            "node": node,
                            "fnLoadComplete": fnLoadComplete
                        },
                        timeout: 7000
                    };
                    
                    YAHOO.util.Connect.asyncRequest('GET', sUrl, callback);
                }
                
                function buildTree(){
                    tree = new YAHOO.widget.TreeView("treeDiv1");
                    tree.setDynamicLoad(loadNodeData, currentIconMode);
                    var root = tree.getRoot();
                    
                    var aStates = ["Procesos"];
                    
                    for (var i = 0, j = aStates.length; i < j; i++) {
                        var tempNode = new YAHOO.widget.TextNode(aStates[i], root, false);
                    }
                    tree.draw();
                }
                
                
                return {
                    init: function(){
                        buildTree();
                    }
                    
                }
            }
            ();
            
            YAHOO.util.Event.onDOMReady(Erlflow.main.treeProcesses.init, Erlflow.main.treeProcesses, true)
        </script>
    </body>
</html>
